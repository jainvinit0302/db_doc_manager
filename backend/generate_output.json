{"csv":"target_db,target_schema,target_table,target_column,target_type,source_id,source_path,transform,default,mapping_rule,notes\ndw,dim,dim_customer,customer_id,STRING,mongo_customers,$.id,,,,\ndw,dim,dim_customer,first_name,STRING,mongo_customers,$.profile.name.first,,,,\ndw,dim,dim_customer,last_name,STRING,mongo_customers,$.profile.name.last,,,,\ndw,dim,dim_customer,email,STRING,mongo_customers,$.contacts.emails[0],,,,\ndw,dim,dim_customer,phone,STRING,mongo_customers,$.contacts.phone.primary,,,,\ndw,dim,dim_customer,country_code,STRING,mongo_customers,$.location.country_code,,,,\ndw,dim,dim_customer,customer_sk,BIGINT,,,,,sequence('seq_customer_master'),\ndw,dim,dim_product,product_id,STRING,event_file,$.payload.product.id,,,,\ndw,dim,dim_product,name,STRING,event_file,$.payload.product.title,,,,\ndw,dim,dim_product,category,STRING,event_file,$.payload.product.category,,,,\ndw,dim,dim_product,brand,STRING,event_file,$.payload.product.brand,,,,\ndw,dim,dim_product,product_sk,BIGINT,,,,,sequence('seq_product_master'),\ndw,fact,fct_order,order_id,STRING,mysql_orders,$.order_id,,,,\ndw,fact,fct_order,order_amount,DECIMAL(14,mysql_orders,$.total_amount,,,,\ndw,fact,fct_order,currency,STRING,mysql_orders,$.currency,,,,\ndw,fact,fct_order,order_ts,TIMESTAMP,mysql_orders,$.created_at,,,,\ndw,fact,fct_order,payment_type,STRING,mysql_orders,$.payment_method,,,,\ndw,fact,fct_order,is_chargeback,BOOLEAN,mysql_orders,$.chargeback_flag,,,,\ndw,fact,fct_order,order_sk,BIGINT,,,,,uuid(),\ndw,fact,fct_order,customer_sk,BIGINT,,,,,\"lookup_surrogate('dim_customer', mysql_orders.customer_id)\",\ndw,fact,fct_order,product_sk,BIGINT,,,,,\"lookup_surrogate('dim_product', mysql_orders.product_id)\",\nanalytics,curated,txn_enriched_v2,order_id,STRING,mysql_orders,$.order_id,,,,\nanalytics,curated,txn_enriched_v2,customer_id,STRING,mysql_orders,$.customer_id,,,,\nanalytics,curated,txn_enriched_v2,product_id,STRING,mysql_orders,$.product_id,,,,\nanalytics,curated,txn_enriched_v2,local_currency,STRING,mysql_orders,$.currency,,,,\nanalytics,curated,txn_enriched_v2,region,STRING,mongo_customers,$.location.region,,,,\nanalytics,curated,txn_enriched_v2,loyalty_tier,STRING,mongo_customers,$.loyalty.tier,,,,\nanalytics,curated,txn_enriched_v2,source_system,STRING,event_file,$.payload.source.system,,,,\nanalytics,curated,txn_enriched_v2,ingest_origin,STRING,event_file,$.payload.metadata.origin,,,,\nanalytics,curated,txn_enriched_v2,is_high_value,BOOLEAN,,,,,\"greaterThan(mysql_orders.total_amount, 1000)\",\nanalytics,curated,txn_enriched_v2,amount_usd,FLOAT,,,,,\"convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))\",\nanalytics,curated,txn_enriched_v2,ingestion_ts,TIMESTAMP,,,,,now(),\nrefdb,ref,fx_rates,currency,STRING,mysql_ref,$.currency,,,,\nrefdb,ref,fx_rates,usd_rate,FLOAT,mysql_ref,$.usd_rate,,,,\nrefdb,ref,fx_rates,as_of_ts,TIMESTAMP,mysql_ref,$.as_of_ts,,,,\ndw,dim,dim_product,created_at,TIMESTAMP,snowflake_catalog,$.system_timestamp,,,,","mermaids":[{"name":"erd_analytics_curated.mmd","content":"erDiagram\n\n  txn_enriched_v2 {\n    order_id string\n    customer_id string\n    product_id string\n    amount_usd float\n    local_currency string\n    region string\n    loyalty_tier string\n    is_high_value boolean\n    ingestion_ts timestamp\n    source_system string\n    ingest_origin string\n  }\n\n"},{"name":"erd_dw_dim.mmd","content":"erDiagram\n\n  dim_customer {\n    customer_sk bigint\n    customer_id string\n    first_name string\n    last_name string\n    email string\n    phone string\n    country_code string\n    created_at timestamp\n    updated_at timestamp\n  }\n\n  dim_product {\n    product_sk bigint\n    product_id string\n    name string\n    category string\n    brand string\n    created_at timestamp\n  }\n\n"},{"name":"erd_dw_fact.mmd","content":"erDiagram\n\n  fct_order {\n    order_sk bigint\n    order_id string\n    customer_sk bigint\n    product_sk bigint\n    order_amount decimal_14\n    currency string\n    order_ts timestamp\n    payment_type string\n    is_chargeback boolean\n  }\n\n  %% Relationships\n  dim_customer ||--o{ fct_order : \"customer_sk\"\n  dim_product ||--o{ fct_order : \"product_sk\"\n\n"},{"name":"erd_refdb_ref.mmd","content":"erDiagram\n\n  fx_rates {\n    currency string\n    usd_rate float\n    as_of_ts timestamp\n  }\n\n"}],"lineage":{"nodes":[{"id":"src:mongo_customers","type":"source","label":"mongo_customers","meta":{"id":"mongo_customers","kind":"mongodb","conn":"atlas-global","db":"omni","collection":"customers"}},{"id":"src:mysql_orders","type":"source","label":"mysql_orders","meta":{"id":"mysql_orders","kind":"mysql","host":"orders.cluster.internal","db":"ecommerce","schema":"prod"}},{"id":"src:event_file","type":"source","label":"event_file","meta":{"id":"event_file","kind":"file","format":"jsonl","path":"/data/events/orders_v2.jsonl"}},{"id":"src:snowflake_catalog","type":"source","label":"snowflake_catalog","meta":{"id":"snowflake_catalog","kind":"snowflake","warehouse":"WH_MEDIUM","db":"ref","schema":"finance"}},{"id":"src:mysql_ref","type":"source","label":"mysql_ref","meta":{"id":"mysql_ref","kind":"mysql","host":"refdb.internal","db":"refdb","schema":"ref"}},{"id":"t:dw.dim.dim_customer","type":"table","label":"dw.dim.dim_customer","meta":{"db":"dw","schema":"dim","table":"dim_customer"}},{"id":"t:dw.dim.dim_customer.customer_sk","type":"column","label":"customer_sk","meta":{"name":"customer_sk","type":"BIGINT","pk":true,"table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.customer_id","type":"column","label":"customer_id","meta":{"name":"customer_id","type":"STRING","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.first_name","type":"column","label":"first_name","meta":{"name":"first_name","type":"STRING","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.last_name","type":"column","label":"last_name","meta":{"name":"last_name","type":"STRING","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.email","type":"column","label":"email","meta":{"name":"email","type":"STRING","not_null":true,"table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.phone","type":"column","label":"phone","meta":{"name":"phone","type":"STRING","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.country_code","type":"column","label":"country_code","meta":{"name":"country_code","type":"STRING","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.created_at","type":"column","label":"created_at","meta":{"name":"created_at","type":"TIMESTAMP","default":"CURRENT_TIMESTAMP","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_customer.updated_at","type":"column","label":"updated_at","meta":{"name":"updated_at","type":"TIMESTAMP","default":"CURRENT_TIMESTAMP","table":"dw.dim.dim_customer"}},{"id":"t:dw.dim.dim_product","type":"table","label":"dw.dim.dim_product","meta":{"db":"dw","schema":"dim","table":"dim_product"}},{"id":"t:dw.dim.dim_product.product_sk","type":"column","label":"product_sk","meta":{"name":"product_sk","type":"BIGINT","pk":true,"table":"dw.dim.dim_product"}},{"id":"t:dw.dim.dim_product.product_id","type":"column","label":"product_id","meta":{"name":"product_id","type":"STRING","table":"dw.dim.dim_product"}},{"id":"t:dw.dim.dim_product.name","type":"column","label":"name","meta":{"name":"name","type":"STRING","table":"dw.dim.dim_product"}},{"id":"t:dw.dim.dim_product.category","type":"column","label":"category","meta":{"name":"category","type":"STRING","table":"dw.dim.dim_product"}},{"id":"t:dw.dim.dim_product.brand","type":"column","label":"brand","meta":{"name":"brand","type":"STRING","table":"dw.dim.dim_product"}},{"id":"t:dw.dim.dim_product.created_at","type":"column","label":"created_at","meta":{"name":"created_at","type":"TIMESTAMP","default":"CURRENT_TIMESTAMP","table":"dw.dim.dim_product"}},{"id":"t:dw.fact.fct_order","type":"table","label":"dw.fact.fct_order","meta":{"db":"dw","schema":"fact","table":"fct_order"}},{"id":"t:dw.fact.fct_order.order_sk","type":"column","label":"order_sk","meta":{"name":"order_sk","type":"BIGINT","pk":true,"table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.order_id","type":"column","label":"order_id","meta":{"name":"order_id","type":"STRING","table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.customer_sk","type":"column","label":"customer_sk","meta":{"name":"customer_sk","type":"BIGINT","fk":{"schema":"dim","table":"dim_customer","column":"customer_sk"},"table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.product_sk","type":"column","label":"product_sk","meta":{"name":"product_sk","type":"BIGINT","fk":{"schema":"dim","table":"dim_product","column":"product_sk"},"table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.order_amount","type":"column","label":"order_amount","meta":{"name":"order_amount","type":"DECIMAL(14","4)":null,"table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.currency","type":"column","label":"currency","meta":{"name":"currency","type":"STRING","table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.order_ts","type":"column","label":"order_ts","meta":{"name":"order_ts","type":"TIMESTAMP","table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.payment_type","type":"column","label":"payment_type","meta":{"name":"payment_type","type":"STRING","table":"dw.fact.fct_order"}},{"id":"t:dw.fact.fct_order.is_chargeback","type":"column","label":"is_chargeback","meta":{"name":"is_chargeback","type":"BOOLEAN","default":"false","table":"dw.fact.fct_order"}},{"id":"t:analytics.curated.txn_enriched_v2","type":"table","label":"analytics.curated.txn_enriched_v2","meta":{"db":"analytics","schema":"curated","table":"txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.order_id","type":"column","label":"order_id","meta":{"name":"order_id","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.customer_id","type":"column","label":"customer_id","meta":{"name":"customer_id","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.product_id","type":"column","label":"product_id","meta":{"name":"product_id","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.amount_usd","type":"column","label":"amount_usd","meta":{"name":"amount_usd","type":"FLOAT","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.local_currency","type":"column","label":"local_currency","meta":{"name":"local_currency","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.region","type":"column","label":"region","meta":{"name":"region","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.loyalty_tier","type":"column","label":"loyalty_tier","meta":{"name":"loyalty_tier","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.is_high_value","type":"column","label":"is_high_value","meta":{"name":"is_high_value","type":"BOOLEAN","default":"false","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.ingestion_ts","type":"column","label":"ingestion_ts","meta":{"name":"ingestion_ts","type":"TIMESTAMP","default":"CURRENT_TIMESTAMP","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.source_system","type":"column","label":"source_system","meta":{"name":"source_system","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:analytics.curated.txn_enriched_v2.ingest_origin","type":"column","label":"ingest_origin","meta":{"name":"ingest_origin","type":"STRING","table":"analytics.curated.txn_enriched_v2"}},{"id":"t:refdb.ref.fx_rates","type":"table","label":"refdb.ref.fx_rates","meta":{"db":"refdb","schema":"ref","table":"fx_rates"}},{"id":"t:refdb.ref.fx_rates.currency","type":"column","label":"currency","meta":{"name":"currency","type":"STRING","pk":true,"table":"refdb.ref.fx_rates"}},{"id":"t:refdb.ref.fx_rates.usd_rate","type":"column","label":"usd_rate","meta":{"name":"usd_rate","type":"FLOAT","table":"refdb.ref.fx_rates"}},{"id":"t:refdb.ref.fx_rates.as_of_ts","type":"column","label":"as_of_ts","meta":{"name":"as_of_ts","type":"TIMESTAMP","table":"refdb.ref.fx_rates"}},{"id":"src:mongo_customers:$.id","type":"source_column","label":"$.id","meta":{"source_id":"mongo_customers","path":"$.id"}},{"id":"src:mongo_customers:$.profile.name.first","type":"source_column","label":"$.profile.name.first","meta":{"source_id":"mongo_customers","path":"$.profile.name.first"}},{"id":"src:mongo_customers:$.profile.name.last","type":"source_column","label":"$.profile.name.last","meta":{"source_id":"mongo_customers","path":"$.profile.name.last"}},{"id":"src:mongo_customers:$.contacts.emails[0]","type":"source_column","label":"$.contacts.emails[0]","meta":{"source_id":"mongo_customers","path":"$.contacts.emails[0]"}},{"id":"src:mongo_customers:$.contacts.phone.primary","type":"source_column","label":"$.contacts.phone.primary","meta":{"source_id":"mongo_customers","path":"$.contacts.phone.primary"}},{"id":"src:mongo_customers:$.location.country_code","type":"source_column","label":"$.location.country_code","meta":{"source_id":"mongo_customers","path":"$.location.country_code"}},{"id":"rule:sequence('seq_customer_master')","type":"rule","label":"sequence('seq_customer_master')","meta":{"rule":"sequence('seq_customer_master')"}},{"id":"src:event_file:$.payload.product.id","type":"source_column","label":"$.payload.product.id","meta":{"source_id":"event_file","path":"$.payload.product.id"}},{"id":"src:event_file:$.payload.product.title","type":"source_column","label":"$.payload.product.title","meta":{"source_id":"event_file","path":"$.payload.product.title"}},{"id":"src:event_file:$.payload.product.category","type":"source_column","label":"$.payload.product.category","meta":{"source_id":"event_file","path":"$.payload.product.category"}},{"id":"src:event_file:$.payload.product.brand","type":"source_column","label":"$.payload.product.brand","meta":{"source_id":"event_file","path":"$.payload.product.brand"}},{"id":"rule:sequence('seq_product_master')","type":"rule","label":"sequence('seq_product_master')","meta":{"rule":"sequence('seq_product_master')"}},{"id":"src:mysql_orders:$.order_id","type":"source_column","label":"$.order_id","meta":{"source_id":"mysql_orders","path":"$.order_id"}},{"id":"src:mysql_orders:$.total_amount","type":"source_column","label":"$.total_amount","meta":{"source_id":"mysql_orders","path":"$.total_amount"}},{"id":"src:mysql_orders:$.currency","type":"source_column","label":"$.currency","meta":{"source_id":"mysql_orders","path":"$.currency"}},{"id":"src:mysql_orders:$.created_at","type":"source_column","label":"$.created_at","meta":{"source_id":"mysql_orders","path":"$.created_at"}},{"id":"src:mysql_orders:$.payment_method","type":"source_column","label":"$.payment_method","meta":{"source_id":"mysql_orders","path":"$.payment_method"}},{"id":"src:mysql_orders:$.chargeback_flag","type":"source_column","label":"$.chargeback_flag","meta":{"source_id":"mysql_orders","path":"$.chargeback_flag"}},{"id":"rule:uuid()","type":"rule","label":"uuid()","meta":{"rule":"uuid()"}},{"id":"rule:lookup_surrogate('dim_customer', mysql_orders.customer_id)","type":"rule","label":"lookup_surrogate('dim_customer', mysql_orders.customer_id)","meta":{"rule":"lookup_surrogate('dim_customer', mysql_orders.customer_id)"}},{"id":"rule:lookup_surrogate('dim_product', mysql_orders.product_id)","type":"rule","label":"lookup_surrogate('dim_product', mysql_orders.product_id)","meta":{"rule":"lookup_surrogate('dim_product', mysql_orders.product_id)"}},{"id":"src:mysql_orders:$.customer_id","type":"source_column","label":"$.customer_id","meta":{"source_id":"mysql_orders","path":"$.customer_id"}},{"id":"src:mysql_orders:$.product_id","type":"source_column","label":"$.product_id","meta":{"source_id":"mysql_orders","path":"$.product_id"}},{"id":"src:mongo_customers:$.location.region","type":"source_column","label":"$.location.region","meta":{"source_id":"mongo_customers","path":"$.location.region"}},{"id":"src:mongo_customers:$.loyalty.tier","type":"source_column","label":"$.loyalty.tier","meta":{"source_id":"mongo_customers","path":"$.loyalty.tier"}},{"id":"src:event_file:$.payload.source.system","type":"source_column","label":"$.payload.source.system","meta":{"source_id":"event_file","path":"$.payload.source.system"}},{"id":"src:event_file:$.payload.metadata.origin","type":"source_column","label":"$.payload.metadata.origin","meta":{"source_id":"event_file","path":"$.payload.metadata.origin"}},{"id":"rule:greaterThan(mysql_orders.total_amount, 1000)","type":"rule","label":"greaterThan(mysql_orders.total_amount, 1000)","meta":{"rule":"greaterThan(mysql_orders.total_amount, 1000)"}},{"id":"rule:convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))","type":"rule","label":"convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))","meta":{"rule":"convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))"}},{"id":"rule:now()","type":"rule","label":"now()","meta":{"rule":"now()"}},{"id":"src:mysql_ref:$.currency","type":"source_column","label":"$.currency","meta":{"source_id":"mysql_ref","path":"$.currency"}},{"id":"src:mysql_ref:$.usd_rate","type":"source_column","label":"$.usd_rate","meta":{"source_id":"mysql_ref","path":"$.usd_rate"}},{"id":"src:mysql_ref:$.as_of_ts","type":"source_column","label":"$.as_of_ts","meta":{"source_id":"mysql_ref","path":"$.as_of_ts"}},{"id":"src:snowflake_catalog:$.system_timestamp","type":"source_column","label":"$.system_timestamp","meta":{"source_id":"snowflake_catalog","path":"$.system_timestamp"}}],"edges":[{"id":"e1","source":"src:mongo_customers:$.id","target":"t:dw.dim.dim_customer.customer_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.customer_id"}},{"id":"e2","source":"src:mongo_customers:$.profile.name.first","target":"t:dw.dim.dim_customer.first_name","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.first_name"}},{"id":"e3","source":"src:mongo_customers:$.profile.name.last","target":"t:dw.dim.dim_customer.last_name","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.last_name"}},{"id":"e4","source":"src:mongo_customers:$.contacts.emails[0]","target":"t:dw.dim.dim_customer.email","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.email"}},{"id":"e5","source":"src:mongo_customers:$.contacts.phone.primary","target":"t:dw.dim.dim_customer.phone","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.phone"}},{"id":"e6","source":"src:mongo_customers:$.location.country_code","target":"t:dw.dim.dim_customer.country_code","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_customer.country_code"}},{"id":"e7","source":"rule:sequence('seq_customer_master')","target":"t:dw.dim.dim_customer.customer_sk","type":"column_lineage","meta":{"rule":"sequence('seq_customer_master')"}},{"id":"e8","source":"src:event_file:$.payload.product.id","target":"t:dw.dim.dim_product.product_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_product.product_id"}},{"id":"e9","source":"src:event_file:$.payload.product.title","target":"t:dw.dim.dim_product.name","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_product.name"}},{"id":"e10","source":"src:event_file:$.payload.product.category","target":"t:dw.dim.dim_product.category","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_product.category"}},{"id":"e11","source":"src:event_file:$.payload.product.brand","target":"t:dw.dim.dim_product.brand","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_product.brand"}},{"id":"e12","source":"rule:sequence('seq_product_master')","target":"t:dw.dim.dim_product.product_sk","type":"column_lineage","meta":{"rule":"sequence('seq_product_master')"}},{"id":"e13","source":"src:mysql_orders:$.order_id","target":"t:dw.fact.fct_order.order_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.order_id"}},{"id":"e14","source":"src:mysql_orders:$.total_amount","target":"t:dw.fact.fct_order.order_amount","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.order_amount"}},{"id":"e15","source":"src:mysql_orders:$.currency","target":"t:dw.fact.fct_order.currency","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.currency"}},{"id":"e16","source":"src:mysql_orders:$.created_at","target":"t:dw.fact.fct_order.order_ts","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.order_ts"}},{"id":"e17","source":"src:mysql_orders:$.payment_method","target":"t:dw.fact.fct_order.payment_type","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.payment_type"}},{"id":"e18","source":"src:mysql_orders:$.chargeback_flag","target":"t:dw.fact.fct_order.is_chargeback","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.fact.fct_order.is_chargeback"}},{"id":"e19","source":"rule:uuid()","target":"t:dw.fact.fct_order.order_sk","type":"column_lineage","meta":{"rule":"uuid()"}},{"id":"e20","source":"rule:lookup_surrogate('dim_customer', mysql_orders.customer_id)","target":"t:dw.fact.fct_order.customer_sk","type":"column_lineage","meta":{"rule":"lookup_surrogate('dim_customer', mysql_orders.customer_id)"}},{"id":"e21","source":"rule:lookup_surrogate('dim_product', mysql_orders.product_id)","target":"t:dw.fact.fct_order.product_sk","type":"column_lineage","meta":{"rule":"lookup_surrogate('dim_product', mysql_orders.product_id)"}},{"id":"e22","source":"src:mysql_orders:$.order_id","target":"t:analytics.curated.txn_enriched_v2.order_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.order_id"}},{"id":"e23","source":"src:mysql_orders:$.customer_id","target":"t:analytics.curated.txn_enriched_v2.customer_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.customer_id"}},{"id":"e24","source":"src:mysql_orders:$.product_id","target":"t:analytics.curated.txn_enriched_v2.product_id","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.product_id"}},{"id":"e25","source":"src:mysql_orders:$.currency","target":"t:analytics.curated.txn_enriched_v2.local_currency","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.local_currency"}},{"id":"e26","source":"src:mongo_customers:$.location.region","target":"t:analytics.curated.txn_enriched_v2.region","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.region"}},{"id":"e27","source":"src:mongo_customers:$.loyalty.tier","target":"t:analytics.curated.txn_enriched_v2.loyalty_tier","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.loyalty_tier"}},{"id":"e28","source":"src:event_file:$.payload.source.system","target":"t:analytics.curated.txn_enriched_v2.source_system","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.source_system"}},{"id":"e29","source":"src:event_file:$.payload.metadata.origin","target":"t:analytics.curated.txn_enriched_v2.ingest_origin","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"analytics.curated.txn_enriched_v2.ingest_origin"}},{"id":"e30","source":"rule:greaterThan(mysql_orders.total_amount, 1000)","target":"t:analytics.curated.txn_enriched_v2.is_high_value","type":"column_lineage","meta":{"rule":"greaterThan(mysql_orders.total_amount, 1000)"}},{"id":"e31","source":"rule:convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))","target":"t:analytics.curated.txn_enriched_v2.amount_usd","type":"column_lineage","meta":{"rule":"convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))"}},{"id":"e32","source":"rule:now()","target":"t:analytics.curated.txn_enriched_v2.ingestion_ts","type":"column_lineage","meta":{"rule":"now()"}},{"id":"e33","source":"src:mysql_ref:$.currency","target":"t:refdb.ref.fx_rates.currency","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"refdb.ref.fx_rates.currency"}},{"id":"e34","source":"src:mysql_ref:$.usd_rate","target":"t:refdb.ref.fx_rates.usd_rate","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"refdb.ref.fx_rates.usd_rate"}},{"id":"e35","source":"src:mysql_ref:$.as_of_ts","target":"t:refdb.ref.fx_rates.as_of_ts","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"refdb.ref.fx_rates.as_of_ts"}},{"id":"e36","source":"src:snowflake_catalog:$.system_timestamp","target":"t:dw.dim.dim_product.created_at","type":"column_lineage","meta":{"transform":null,"rule":null,"raw":"dw.dim.dim_product.created_at"}}],"table_edges":[{"id":"te1","source":"src:mongo_customers","target":"t:dw.dim.dim_customer","meta":{"columns":["customer_id","first_name","last_name","email","phone","country_code"]}},{"id":"te2","source":"rule:sequence('seq_customer_master')","target":"t:dw.dim.dim_customer","meta":{"columns":["customer_sk"]}},{"id":"te3","source":"src:event_file","target":"t:dw.dim.dim_product","meta":{"columns":["product_id","name","category","brand"]}},{"id":"te4","source":"rule:sequence('seq_product_master')","target":"t:dw.dim.dim_product","meta":{"columns":["product_sk"]}},{"id":"te5","source":"src:mysql_orders","target":"t:dw.fact.fct_order","meta":{"columns":["order_id","order_amount","currency","order_ts","payment_type","is_chargeback"]}},{"id":"te6","source":"rule:uuid()","target":"t:dw.fact.fct_order","meta":{"columns":["order_sk"]}},{"id":"te7","source":"rule:lookup_surrogate('dim_customer', mysql_orders.customer_id)","target":"t:dw.fact.fct_order","meta":{"columns":["customer_sk"]}},{"id":"te8","source":"rule:lookup_surrogate('dim_product', mysql_orders.product_id)","target":"t:dw.fact.fct_order","meta":{"columns":["product_sk"]}},{"id":"te9","source":"src:mysql_orders","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["order_id","customer_id","product_id","local_currency"]}},{"id":"te10","source":"src:mongo_customers","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["region","loyalty_tier"]}},{"id":"te11","source":"src:event_file","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["source_system","ingest_origin"]}},{"id":"te12","source":"rule:greaterThan(mysql_orders.total_amount, 1000)","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["is_high_value"]}},{"id":"te13","source":"rule:convert_to_usd(mysql_orders.total_amount, lookup_rate(mysql_orders.currency, 'refdb.fx_rates'))","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["amount_usd"]}},{"id":"te14","source":"rule:now()","target":"t:analytics.curated.txn_enriched_v2","meta":{"columns":["ingestion_ts"]}},{"id":"te15","source":"src:mysql_ref","target":"t:refdb.ref.fx_rates","meta":{"columns":["currency","usd_rate","as_of_ts"]}},{"id":"te16","source":"src:snowflake_catalog","target":"t:dw.dim.dim_product","meta":{"columns":["created_at"]}}]},"sql":{"sql":"CREATE TABLE IF NOT EXISTS analytics.curated.txn_enriched_v2 (\n  order_id STRING,\n  customer_id STRING,\n  product_id STRING,\n  amount_usd FLOAT,\n  local_currency STRING,\n  region STRING,\n  loyalty_tier STRING,\n  is_high_value BOOLEAN,\n  ingestion_ts TIMESTAMP,\n  source_system STRING,\n  ingest_origin STRING\n);\n\nCREATE TABLE IF NOT EXISTS dw.dim.dim_customer (\n  customer_sk BIGINT,\n  customer_id STRING,\n  first_name STRING,\n  last_name STRING,\n  email STRING,\n  phone STRING,\n  country_code STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS dw.dim.dim_product (\n  product_sk BIGINT,\n  product_id STRING,\n  name STRING,\n  category STRING,\n  brand STRING,\n  created_at TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS dw.fact.fct_order (\n  order_sk BIGINT,\n  order_id STRING,\n  customer_sk BIGINT,\n  product_sk BIGINT,\n  order_amount DECIMAL(14,\n  currency STRING,\n  order_ts TIMESTAMP,\n  payment_type STRING,\n  is_chargeback BOOLEAN\n);\n\nCREATE TABLE IF NOT EXISTS refdb.ref.fx_rates (\n  currency STRING,\n  usd_rate FLOAT,\n  as_of_ts TIMESTAMP\n);","postgres":"CREATE TABLE IF NOT EXISTS analytics.curated.txn_enriched_v2 (\n  order_id STRING,\n  customer_id STRING,\n  product_id STRING,\n  amount_usd FLOAT,\n  local_currency STRING,\n  region STRING,\n  loyalty_tier STRING,\n  is_high_value BOOLEAN,\n  ingestion_ts TIMESTAMP,\n  source_system STRING,\n  ingest_origin STRING\n);\n\nCREATE TABLE IF NOT EXISTS dw.dim.dim_customer (\n  customer_sk BIGINT,\n  customer_id STRING,\n  first_name STRING,\n  last_name STRING,\n  email STRING,\n  phone STRING,\n  country_code STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS dw.dim.dim_product (\n  product_sk BIGINT,\n  product_id STRING,\n  name STRING,\n  category STRING,\n  brand STRING,\n  created_at TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS dw.fact.fct_order (\n  order_sk BIGINT,\n  order_id STRING,\n  customer_sk BIGINT,\n  product_sk BIGINT,\n  order_amount DECIMAL(14,\n  currency STRING,\n  order_ts TIMESTAMP,\n  payment_type STRING,\n  is_chargeback BOOLEAN\n);\n\nCREATE TABLE IF NOT EXISTS refdb.ref.fx_rates (\n  currency STRING,\n  usd_rate FLOAT,\n  as_of_ts TIMESTAMP\n);","snowflake":"CREATE OR REPLACE TABLE analytics.curated.txn_enriched_v2 (\n  order_id STRING,\n  customer_id STRING,\n  product_id STRING,\n  amount_usd FLOAT,\n  local_currency STRING,\n  region STRING,\n  loyalty_tier STRING,\n  is_high_value BOOLEAN,\n  ingestion_ts TIMESTAMP,\n  source_system STRING,\n  ingest_origin STRING\n);\n\nCREATE OR REPLACE TABLE dw.dim.dim_customer (\n  customer_sk BIGINT,\n  customer_id STRING,\n  first_name STRING,\n  last_name STRING,\n  email STRING,\n  phone STRING,\n  country_code STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP\n);\n\nCREATE OR REPLACE TABLE dw.dim.dim_product (\n  product_sk BIGINT,\n  product_id STRING,\n  name STRING,\n  category STRING,\n  brand STRING,\n  created_at TIMESTAMP\n);\n\nCREATE OR REPLACE TABLE dw.fact.fct_order (\n  order_sk BIGINT,\n  order_id STRING,\n  customer_sk BIGINT,\n  product_sk BIGINT,\n  order_amount DECIMAL(14,\n  currency STRING,\n  order_ts TIMESTAMP,\n  payment_type STRING,\n  is_chargeback BOOLEAN\n);\n\nCREATE OR REPLACE TABLE refdb.ref.fx_rates (\n  currency STRING,\n  usd_rate FLOAT,\n  as_of_ts TIMESTAMP\n);","mongodb":"// MongoDB Schema Validation Script\n\n// Run this in mongosh or a driver\n\ndb.createCollection(\"txn_enriched_v2\", {\n  validator: {\n    $jsonSchema: {\n      bsonType: \"object\",\n      required: [\"order_id\", \"customer_id\", \"product_id\", \"amount_usd\", \"local_currency\", \"region\", \"loyalty_tier\", \"is_high_value\", \"ingestion_ts\", \"source_system\", \"ingest_origin\"],\n      properties: {\n        \"order_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"customer_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"product_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"amount_usd\": {\n          bsonType: \"double\",\n          description: \"must be a double and is required\"\n        },\n        \"local_currency\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"region\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"loyalty_tier\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"is_high_value\": {\n          bsonType: \"bool\",\n          description: \"must be a bool and is required\"\n        },\n        \"ingestion_ts\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n        \"source_system\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"ingest_origin\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n      }\n    }\n  }\n});\n\ndb.createCollection(\"dim_customer\", {\n  validator: {\n    $jsonSchema: {\n      bsonType: \"object\",\n      required: [\"customer_sk\", \"customer_id\", \"first_name\", \"last_name\", \"email\", \"phone\", \"country_code\", \"created_at\", \"updated_at\"],\n      properties: {\n        \"customer_sk\": {\n          bsonType: \"int\",\n          description: \"must be a int and is required\"\n        },\n        \"customer_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"first_name\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"last_name\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"email\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"phone\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"country_code\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"created_at\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n        \"updated_at\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n      }\n    }\n  }\n});\n\ndb.createCollection(\"dim_product\", {\n  validator: {\n    $jsonSchema: {\n      bsonType: \"object\",\n      required: [\"product_sk\", \"product_id\", \"name\", \"category\", \"brand\", \"created_at\"],\n      properties: {\n        \"product_sk\": {\n          bsonType: \"int\",\n          description: \"must be a int and is required\"\n        },\n        \"product_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"name\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"category\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"brand\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"created_at\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n      }\n    }\n  }\n});\n\ndb.createCollection(\"fct_order\", {\n  validator: {\n    $jsonSchema: {\n      bsonType: \"object\",\n      required: [\"order_sk\", \"order_id\", \"customer_sk\", \"product_sk\", \"order_amount\", \"currency\", \"order_ts\", \"payment_type\", \"is_chargeback\"],\n      properties: {\n        \"order_sk\": {\n          bsonType: \"int\",\n          description: \"must be a int and is required\"\n        },\n        \"order_id\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"customer_sk\": {\n          bsonType: \"int\",\n          description: \"must be a int and is required\"\n        },\n        \"product_sk\": {\n          bsonType: \"int\",\n          description: \"must be a int and is required\"\n        },\n        \"order_amount\": {\n          bsonType: \"double\",\n          description: \"must be a double and is required\"\n        },\n        \"currency\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"order_ts\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n        \"payment_type\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"is_chargeback\": {\n          bsonType: \"bool\",\n          description: \"must be a bool and is required\"\n        },\n      }\n    }\n  }\n});\n\ndb.createCollection(\"fx_rates\", {\n  validator: {\n    $jsonSchema: {\n      bsonType: \"object\",\n      required: [\"currency\", \"usd_rate\", \"as_of_ts\"],\n      properties: {\n        \"currency\": {\n          bsonType: \"string\",\n          description: \"must be a string and is required\"\n        },\n        \"usd_rate\": {\n          bsonType: \"double\",\n          description: \"must be a double and is required\"\n        },\n        \"as_of_ts\": {\n          bsonType: \"date\",\n          description: \"must be a date and is required\"\n        },\n      }\n    }\n  }\n});"},"referentialWarnings":[]}